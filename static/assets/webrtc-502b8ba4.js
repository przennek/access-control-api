var a=null,t,r,S={iceServers:[]},k={optional:[]},T={optional:[],mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},l=!1,s=[];RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection;RTCSessionDescription=window.RTCSessionDescription;RTCIceCandidate=window.RTCIceCandidate;navigator.getUserMedia=navigator.mediaDevices.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia;function R(){try{var e=S;t=new RTCPeerConnection(e,k),t.onicecandidate=y,t.ontrack=I,t.onremovestream=b}catch{console.error("createPeerConnection() failed")}}function y(e){if(e.candidate&&e.candidate.candidate){var o={sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid,candidate:e.candidate.candidate},n={what:"addIceCandidate",data:JSON.stringify(o)};a.send(JSON.stringify(n))}}function m(){s.forEach(function(e){t.addIceCandidate(e,function(){},function(o){console.error("addIceCandidate error: "+o)})}),s=[]}function I(e){var o=document.getElementById("remote-audio");o.srcObject=e.streams[0]}function b(e){var o=document.getElementById("remote-audio");o.srcObject=null}const O=()=>{if("WebSocket"in window){let o=function(n){s=[],l=!1,R(),n&&t.addStream(n);var i={what:"call",options:{force_hw_vcodec:!0,vformat:void 0,trickle_ice:!0}};a.send(JSON.stringify(i))};document.documentElement.style.cursor="wait";var e=location.protocol==="https:"?"wss:":"ws:";a=new WebSocket(e+"//bramka:8080/stream/webrtc"),a.onopen=function(){r=null,navigator.mediaDevices.getUserMedia({audio:{autoGainControl:!0,channelCount:1,echoCancellation:!0,latency:0,noiseSuppression:!0,sampleRate:48e3,sampleSize:16,volume:1}}).then(function(n){r=n,o(n)}).catch(function(n){v(),alert("An error has occurred. Check media device, permissions on media and origin."),console.error(n)})},a.onmessage=function(n){var i=JSON.parse(n.data);if(i.what!=="undefined")var w=i.what,p=i.data;switch(w){case"offer":console.log(p),t.setRemoteDescription(new RTCSessionDescription(JSON.parse(p)),function(){l=!0,m(),t.createAnswer(function(d){t.setLocalDescription(d);var h={what:"answer",data:JSON.stringify(d)};a.send(JSON.stringify(h))},function(d){alert("Failed to createAnswer: "+d)},T)},function(d){alert("Failed to set remote description (unsupported codec on this browser?): "+d),v()});case"answer":break;case"message":alert(i.data);break;case"iceCandidate":if(!i.data)break;var c=JSON.parse(i.data);let C=new RTCIceCandidate({sdpMLineIndex:c.sdpMLineIndex,candidate:c.candidate});s.push(C),l&&m(),document.documentElement.style.cursor="default";break;case"iceCandidates":for(var u=JSON.parse(i.data),f=0;u&&f<u.length;f++){var c=u[f];let d=new RTCIceCandidate({sdpMLineIndex:c.sdpMLineIndex,candidate:c.candidate});s.push(d)}l&&m(),document.documentElement.style.cursor="default";break}},a.onclose=function(n){t&&(t.close(),t=null),document.documentElement.style.cursor="default"},a.onerror=function(n){alert("An error has occurred!"),a.close()}}else alert("Sorry, this browser does not support WebSockets.")},v=()=>{if(r){try{r.getVideoTracks().length&&r.getVideoTracks()[0].stop(),r.getAudioTracks().length&&r.getAudioTracks()[0].stop(),r.stop()}catch{for(var e=0;e<r.getTracks().length;e++)r.getTracks()[e].stop()}r=null}document.getElementById("remote-audio").srcObject=null,t&&(t.close(),t=null),a&&(a.close(),a=null),document.documentElement.style.cursor="default"};export{v as a,O as s};
