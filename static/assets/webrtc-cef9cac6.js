var S=typeof InstallTrigger<"u",r=null,t,i,k={iceServers:[]},T={optional:[]},I={optional:[],mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}},l=!1,s=[];RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection;RTCSessionDescription=window.RTCSessionDescription;RTCIceCandidate=window.RTCIceCandidate;navigator.getUserMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia;function y(){try{var e=k;t=new RTCPeerConnection(e,T),t.onicecandidate=R,t.ontrack=b,t.onremovestream=M}catch{console.error("createPeerConnection() failed")}}function R(e){if(e.candidate&&e.candidate.candidate){var o={sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid,candidate:e.candidate.candidate},a={what:"addIceCandidate",data:JSON.stringify(o)};r.send(JSON.stringify(a))}}function m(){s.forEach(function(e){t.addIceCandidate(e,function(){},function(o){console.error("addIceCandidate error: "+o)})}),s=[]}function b(e){var o=document.getElementById("remote-audio");o.srcObject=e.streams[0]}function M(e){var o=document.getElementById("remote-audio");o.srcObject=null}const O=()=>{if("WebSocket"in window){let o=function(a){s=[],l=!1,y(),a&&t.addStream(a);var n={what:"call",options:{force_hw_vcodec:!0,vformat:void 0,trickle_ice:!0}};r.send(JSON.stringify(n))};document.documentElement.style.cursor="wait";var e=location.protocol==="https:"?"wss:":"ws:";r=new WebSocket(e+"//bramka:8080/stream/webrtc"),r.onopen=function(){i=null;var a={};a.audio=S?{echoCancellation:!0}:{optional:[{echoCancellation:!0}]},a.video=!1,a.audio||a.video?navigator.getUserMedia&&navigator.getUserMedia(a,function(n){i=n,o(n)},function(n){p(),alert("An error has occurred. Check media device, permissions on media and origin."),console.error(n)}):o()},r.onmessage=function(a){var n=JSON.parse(a.data);if(n.what!=="undefined")var v=n.what,g=n.data;switch(v){case"offer":t.setRemoteDescription(new RTCSessionDescription(JSON.parse(g)),function(){l=!0,m(),t.createAnswer(function(d){t.setLocalDescription(d);var h={what:"answer",data:JSON.stringify(d)};r.send(JSON.stringify(h))},function(d){alert("Failed to createAnswer: "+d)},I)},function(d){alert("Failed to set remote description (unsupported codec on this browser?): "+d),p()});case"answer":break;case"message":alert(n.data);break;case"iceCandidate":if(!n.data)break;var c=JSON.parse(n.data);let w=new RTCIceCandidate({sdpMLineIndex:c.sdpMLineIndex,candidate:c.candidate});s.push(w),l&&m(),document.documentElement.style.cursor="default";break;case"iceCandidates":for(var u=JSON.parse(n.data),f=0;u&&f<u.length;f++){var c=u[f];let d=new RTCIceCandidate({sdpMLineIndex:c.sdpMLineIndex,candidate:c.candidate});s.push(d)}l&&m(),document.documentElement.style.cursor="default";break}},r.onclose=function(a){t&&(t.close(),t=null),document.documentElement.style.cursor="default"},r.onerror=function(a){alert("An error has occurred!"),r.close()}}else alert("Sorry, this browser does not support WebSockets.")},p=()=>{if(i){try{i.getVideoTracks().length&&i.getVideoTracks()[0].stop(),i.getAudioTracks().length&&i.getAudioTracks()[0].stop(),i.stop()}catch{for(var e=0;e<i.getTracks().length;e++)i.getTracks()[e].stop()}i=null}document.getElementById("remote-audio").srcObject=null,t&&(t.close(),t=null),r&&(r.close(),r=null),document.documentElement.style.cursor="default"};export{p as a,O as s};
